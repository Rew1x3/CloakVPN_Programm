# üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase –¥–ª—è CloakVPN

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∏–∑ Supabase

### 1. Supabase URL
–ò–∑ –≤–∞—à–µ–π —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: `postgresql://postgres:[YOUR-PASSWORD]@db.ncjadpqxkekqprnvsbee.supabase.co:5432/postgres`

**URL –ø—Ä–æ–µ–∫—Ç–∞:** `https://ncjadpqxkekqprnvsbee.supabase.co`

### 2. Supabase ANON KEY
1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç –≤ [Supabase Dashboard](https://app.supabase.com)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **API**
3. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é **Project API keys**
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **`anon`** –∏–ª–∏ **`public`** key (–ù–ï `service_role` key!)

### 3. –¢–∞–±–ª–∏—Ü–∞ profiles

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É `profiles`, –∫–æ—Ç–æ—Ä–∞—è —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è –≤–∞—à–µ–≥–æ —Å–∞–π—Ç–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `profiles` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—è:
- `id` (UUID, —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ auth.users)
- `email` (TEXT)
- `name` (TEXT)
- `subscription_plan` (TEXT: 'free', 'premium', 'yearly', 'family')
- `subscription_expires_at` (TIMESTAMPTZ)
- `subscription_is_active` (BOOLEAN)
- `telegram_id` (BIGINT, —É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
- `telegram_username` (TEXT)
- `auth_provider` (TEXT: 'email' –∏–ª–∏ 'telegram')
- `last_login` (TIMESTAMPTZ)
- `created_at` (TIMESTAMPTZ)
- `updated_at` (TIMESTAMPTZ)

–ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ `profiles` –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ –ø–∞–ø–∫–∏ `supabase/migrations` –≤–∞—à–µ–≥–æ —Å–∞–π—Ç–∞.

## üîë –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
VITE_SUPABASE_URL=https://ncjadpqxkekqprnvsbee.supabase.co
VITE_SUPABASE_ANON_KEY=–≤–∞—à_anon_key_–∑–¥–µ—Å—å
```

**–í–ê–ñ–ù–û:** 
- –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —Ñ–∞–π–ª `.env` –≤ Git (–æ–Ω —É–∂–µ –≤ `.gitignore`)
- –ó–∞–º–µ–Ω–∏—Ç–µ `–≤–∞—à_anon_key_–∑–¥–µ—Å—å` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π anon key –∏–∑ Supabase

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `profiles` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Table Editor)
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ RLS (Row Level Security) –≤–∫–ª—é—á–µ–Ω –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `profiles`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª–∏—Ç–∏–∫–∏ RLS –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
   - "Users can view own profile" - –¥–ª—è SELECT
   - "Users can update own profile" - –¥–ª—è UPDATE
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "relation 'profiles' does not exist"
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `profiles` —Å–æ–∑–¥–∞–Ω–∞ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ —Å–∞–π—Ç–∞)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ö–µ–º–µ (public)

### –û—à–∏–±–∫–∞: "new row violates row-level security policy"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª–∏—Ç–∏–∫–∏ RLS —Å–æ–∑–¥–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ Supabase Auth

### –û—à–∏–±–∫–∞: "Invalid API key"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `anon` key, –∞ –Ω–µ `service_role` key
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (–¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `https://`)

